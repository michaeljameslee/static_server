(function(){var r=window.$MicrosoftMaps8,t=r.Internal,ei=t._WorkDispatcher,lt=r.ArrowTemplate,a=r.BasicTemplate,oi=t._BinaryObject,nt=r.BitmapImageTemplate,at=t._CurveKey,tt=t._Curve,s=t._Color,vt=t._ComponentNames,si=t._CurveVector4,it=t._CurveColor,v=t._CurveColorHelper,k=t._DiscreteRangeCollectionSpline,n=t._Debug,yt=t._Gimme,o=r.GlobalConfig,i=t._Helper,d=t._JSEvent,pt=t._LatLonCrs,hi=r.LocationRect,wt=t._LoggerConstants,h=t._LruCache,bt=r.Matrix2D,ci=r.Location,kt=r.MapMath,e=r.MercatorCubeCrs,li=t._MercatorTileUtility,c=t._Network,dt=t._Observable,ai=t._ObservableObject,gt=r.Point,vi=t.PyramidTileSpatialIndex,rt=r.Rectangle,ni=t.SheetSpatialIndex,ti=t.StaticPromise,ut=t._TransformCurve,ft=t._HslaTransformCurve,u=r.VectorImageTemplate,yi=r.VectorLabelTemplate,f=t._VectorMath,et=r.ZoomLevel,ot=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),y=function(){function t(r,u,f,e,s,c){var a,v,y,l;this._responsesCache=new h(128);this._sheetbasedSpatialIndex=new ni;this._gridbasedSpatialIndex=new ct;this._map=r;this._workDispatcher=e;this._coreConfig=u;this._constructGeometryFromLabelHints=typeof c=="boolean"?c:!0;a=this instanceof st;v=i._getUseIntData();v?(y=i._getXsrValue(),f=f.replace("ak.dynamic.t{subdomain}.tiles.virtualearth.net","ecn.dynamic.t{subdomain}.m"+y+".tiles.live-int.com"),f=f.replace("{odmgenid}","1")):t.isNotLabelFilteringPrototype()&&!a&&(console.log("** This is the grid based now :) **"),f="http://ecn.api.m2.tiles.live-int.com/vector/vh/{quadKey}?v=6.0&responseType=jsonp&callback={callback}&jsonso={jsonso}&g=1&mkt={mkt}");n.assertNotNullOrEmpty(f,"vectorTileUrlFormat");this._layersOfInterest=s;this._urlFormat=f.replace("{vectorgridsgenid}",o.dynamicProperties.vectorGridsGenerationId).replace("{mkt}",o.dynamicProperties.uiLanguage).replace("{odmgenid}",o.dynamicProperties.compositionHandlerGenerationId);l=o.dynamicProperties.userRegion;this._urlFormat=l&&o.dynamicProperties.isGeopolUserRegion?this._urlFormat.replace(/{ur}/,l):this._urlFormat.replace(/&ur={ur}/,"");this._id=this._jsonsoSuffix="basemap";this._requests={}}return t.isNotLabelFilteringPrototype=function(){var n=i._getUrlParam(window.location,"labelfiltering");return n==="false"||n==="0"},t.prototype.getLayerDataSource=function(n){return!t.isNotLabelFilteringPrototype()&&this._urlFormat.indexOf("//mlm")===-1?new p(n,this,this._sheetbasedSpatialIndex):new p(n,this,this._gridbasedSpatialIndex)},t.prototype.cancelPrimitivesRequest=function(n,i,r){var u=t._getDispatchKey(n,i,r||"",this._id);c.abortRequest(this._requests[u]);this._workDispatcher.cancelDispatchWithKey(u)},t.prototype.getPrimitives=function(n,i,r,u){var o=this,s=n.quadKey+this.getFilterKey(),f=t._getDispatchKey(n,i,u||"",this._id),e=this._responsesCache.getItem(s);e?this._completeRequest(r,this._filterResponse(e[i]),f):this._workDispatcher.dispatch(function(){return o._downloadGrid(n,f,i,r)},f,3)},t.prototype._filterResponse=function(n){return n},t.prototype.applyFilter=function(n){this._filter=n},t.prototype.resetFilter=function(){this._filter=null},t.prototype.getFilterKey=function(){var r="",t=this._filter,i,n;if(t&&t.value&&t.distribution)for(i=t.value,n=0;n<i.length;n++)r+=i[n]+":"+t.distribution[n],n<i.length&&(r+=",");return r},t.prototype._downloadGrid=function(r,u,f,e){var l=this,o=r.quadKey,s,h;n.logDebugData("BaseMapDataSource - _downloadgrid() "+o);n.time(i._formatString("Network call for quadkey - {0}",o));s=this._urlFormat.replace(/{quadKey}/g,o).replace(/{subdomain}/g,i._getTileSubDomain(o)).replace(/{filter}/g,this.getFilterKey());h=null;(!this._coreConfig.autoGenBaseMapJsonso||n.getFunctionalTestHooksEnabled())&&(h=o.toString()+"_"+this._jsonsoSuffix);this._requests[u]=c.downloadJsonp(s,"grid",function(n){l._handleResponse(r,s,u,f,e,n,!0)},function(i,h){n.log(null,"ERROR: failed to get {0}",o);l._handleResponse(r,s,u,f,e,t._createEmptyResponse(),!1,h)},h)},t.prototype._handleResponse=function(t,r,u,f,e,o,s,h){var y=this,l=t.quadKey,p=l+this.getFilterKey(),a,v,c;delete this._requests[u];n.groupCollapsed(null,"Callback for lod: {0} quadkey {1}",t.lod.toString(),l);n.timeEnd(i._formatString("Network call for quadkey - {0}",l));n.time(i._formatString("Parsing vector response for quadkey - {0}",l));o?a=this._parseResponse(o,t,r):(a=this._responsesCache.getItem(p)||{},dt.mergeProperties(a,this._parseNullDataRegion(f)));s&&this._responsesCache.addItem(p,a);n.timeEnd(i._formatString("Parsing vector response for quadkey - {0}",l));v=o&&o.requestFailed?{primitives:null,requestFailed:!0,requestAborted:h===4}:a[f];c=v&&v.primitives;c&&c.length>0?this._map.getTemplateSelector().then(function(n){n.selectorReady().then(function(){for(var r,f,i,o=[],s=[],t=0;t<c.length;t++)c[t].geometryType===1?o.push(c[t].bucket):(r=c[t],f=g.getShieldIndices(r.entity),f.length>0&&s.push({bucketId:r.bucket,indexes:f}));i=[];i.push(n.prefetchImagesByBucketIds(o));i.push(n.prefetchShields(s));Promise.all(i).then(function(){y._completeRequest(e,y._filterResponse(v),u)})})}):this._completeRequest(e,this._filterResponse(v),u);n.groupEnd()},t.prototype._completeRequest=function(n,t,i){var r=function(n,t){return function(){n(t)}}(n,t);this._workDispatcher.dispatch(r,i,3)},t._getDispatchKey=function(n,t,i,r){var u=n.quadKey;return u+"_"+t+"_"+i+"_"+r},t._createEmptyResponse=function(){return{entities:[],layers:{},requestFailed:!0}},t.prototype._parseNullDataRegion=function(n){var r,i;return t._nullDataRegionResponse||(r={isNullDataRegionMarker:!0,crs:pt.instance,geometryType:1,geometry:{x:0,y:0,bounds:[90,180,-90,-180]}},t._nullDataRegionResponse={primitives:[r]}),i={},i[n]=t._nullDataRegionResponse,i},t.getAnchorTextSpan=function(n){var t,i,e,r,o,u,f;if(n&&n.lbl)for(i=0,e=n.lbl.length;i<e;i++){for(r=n.lbl[i],o=r.tps&&r.tps.length||0,u=0;u<o;u++)if(f=r.tps[u],t=t||f,!f.n){t=f;break}if(t&&!t.n)break}return t},t.prototype._constructGeometryFromHint=function(n,i){var u,r=t.getAnchorTextSpan(n),f;if(r)switch(i){case 1:u={x:r.x,y:r.y,bounds:[r.y,r.x,r.y,r.x]};break;case 2:u={x:[r.x,r.x],y:[r.y,r.y],bounds:[r.y,r.x,r.y,r.x]};break;case 3:f={x:[r.x,r.x],y:[r.y,r.y]};u={rings:[f],r:[f],bounds:[r.y,r.x,r.y,r.x]}}return u},t.prototype._logResponseError=function(n,t,i){var u=r.logger,f;u&&(f={feature:vt.BaseMapData,action:wt.Error,data:{layerId:i||"",response:t||"",url:n||""}},u.logObject(f))},t.prototype._parseResponse=function(t,r,u){var ft=t.entities,et=r.crs,v={},h=t.layers,c=t.placement,k,d,y,ot,s,g,p,st,nt,w,e,tt,a,o,f,it,rt,l,b,ut;if(this._constructGeometryFromLabelHints&&c&&c.length>0){for(k={},d=Object.keys(h),y=0,ot=d.length;y<ot;y++)if(s=d[y],this._layersOfInterest.indexOf(s)>-1)for(v[s]={primitives:[]},g=h[s],p=0,st=g.length;p<st;p++)(e=g[p],o=e.entityIndex||e.ei,n.assert(o!==0,"Primitive with entityindex 0 is invalid"),k[o+","+e.gt])||(e.bucket=e.bkt,e.entityIndex=o,e.geometryType=e.gt,e.geometry=this._constructGeometryFromHint(c[o],e.geometryType),n.assert(e.geometry!==null,"Geometry should be constructed from a hint"),f=ft[o],f&&(f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.category=f.category||f.cg,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=c[o],e.entity=f),e.crs=et,v[s].primitives.push(e),k[o+","+e.gt]=o)}else for(s in h)if(h.hasOwnProperty(s))for(v[s]={primitives:h[s]},nt=h[s],w=0;w<nt.length;w++)if(e=nt[w],!e.bucket){e.g||this._logResponseError(u,JSON.stringify(t),s);e.bucket=e.bkt;e.entityIndex=e.ei;e.geometry=e.g;e.geometryType=e.gt;e.geometry.bounds=e.g.b;switch(e.geometryType){case 1:tt=16384;a=e.geometry;e.geometry.bounds=[Math.min(tt,a.y),a.x,a.y,Math.min(tt,a.x)];break;case 3:l=e.geometry;l.rings=l.r}o=e.entityIndex;f=ft[o];f&&(f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.category=f.category||f.cg,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=c&&c[o],e.entity=f.ypid?f:f.tj?f:f);it=e.geometry;switch(e.geometryType){case 2:rt=it;i._deltaDecode(rt.x);i._deltaDecode(rt.y);break;case 3:for(l=it,b=0;b<l.rings.length;b++)ut=l.rings[b],i._deltaDecode(ut.x),i._deltaDecode(ut.y)}e.crs=et}return v},t}(),ii=function(n){function t(t,i,r,u,f){return n.call(this,t,i,r,u,f,!1)||this}return ot(t,n),t}(y),st=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,t,i,r,u,s)||this;return c._importanceThreshold=27,c._percentageforHighImportant=.3,c._id=o,h&&(c._jsonsoSuffix=h),c._minZoom=f,c._maxZoom=e,c}return ot(t,n),t.prototype.getLayerDataSource=function(n){return new p(n,this,this._sheetbasedSpatialIndex)},t.prototype.applyFilter=function(n){this._filter=n},t.prototype.resetFilter=function(){this._filter=null},t.prototype.setLayer=function(n){this._layer=n},t.prototype._filterResponse=function(n){var r={},u,i,t;if(r.primitives=[],n&&n.primitives)for(r.primitives=n.primitives,u=0;u<r.primitives.length;u++)i=r.primitives[u],i.isHoverEnabled||(i.isHoverEnabled=function(){return!0},i.isTapEnabled=function(){return!0}),t=i.entity,t&&(t.changed||(t.changed=new d),t.ypid&&t.ypid.indexOf("ypid:")!==0&&(t.ypid="ypid:"+t.ypid),t.isLandmark=!0),i.layer=this._layer;return r},t.prototype.getPrimitives=function(t,i,u,f,e){var h=y._getDispatchKey(t,i,f||"",this._id),o,s;e=Math.round(e);o=r&&r.Internal&&r.Internal._VenueMapHelper;s=o&&o.isOverlappingVenueMaps(this._coreConfig,t);e<this._minZoom||e>this._maxZoom||this.suppressDataRetrieval&&this.suppressDataRetrieval()||s||this._layer&&!this._layer.getVisible()?n.prototype._completeRequest.call(this,u,{primitives:[]},h):(this._limitPrimitives=12*(e-this._minZoom+1),n.prototype.getPrimitives.call(this,t,i,u,f,e))},t}(y),p=function(){function t(n,t,i){this._layerId=n;this._parentDataSource=t;this.spatialIndex=i;this.invalidated=new d}return t.prototype.getParentDataSource=function(){return this._parentDataSource},t.prototype.getPrimitives=function(n,t,i,r){this._parentDataSource.getPrimitives(n,this._layerId,t,i,r)},t.prototype.applyFilter=function(n){this._parentDataSource.applyFilter(n)},t.prototype.resetFilter=function(){this._parentDataSource.resetFilter()},t.prototype.cancelPrimitivesRequest=function(n,t){this._parentDataSource.cancelPrimitivesRequest(n,this._layerId,t)},t.prototype.getDataUniquenessKey=function(t){n.assertNotNull(t,"regionId");return this._parentDataSource?t.quadKey+this._parentDataSource.getFilterKey():t.quadKey},t}(),pi=function(){function n(){}return n}(),ri=function(){function n(){}return n}(),g=function(){function t(){}return t.getDisplayName=function(n){var i="",t=n;return t.getPrimaryLabelText?i=t.getPrimaryLabelText():t.name?i=t.name:t.getName?i=t.getName():t.title?i=t.title:t.getTitle&&(i=t.getTitle()),i},t.getSecondaryDisplayName=function(n){var i="",t=n;return t.getSecondaryLabelText?i=t.getSecondaryLabelText():t.subtitle?i=t.subtitle:t.getSubtitle&&(i=t.getSubtitle()),i},t.getIconText=function(n){var i="",t=n;return t.getIconText?i=t.getIconText():t.iconText&&(i=t.iconText),i},t.getLabelImportance=function(n){var t=n;return t&&t.labelImportance||0},t.getShieldNames=function(n){var t=n;return t&&t.shieldName},t.getShieldIndices=function(n){var t=n;return t&&t.shieldIndex},t._getShieldAttributeValue=function(n){var t=n&&n.split(":");return t&&t.length>1?t[1].replace(/^["\s]+|["\s]+$/g,""):""},t.getShieldDisplayData=function(i){var r=i.split(","),u="",f="";return n.assertNotNull(r,"shield attributes"),n.assert(r.length===4,"all four shield attributes should be present"),r&&r.length===4&&(u=t._getShieldAttributeValue(r[0]),f=t._getShieldAttributeValue(r[3])),{text:u,modifier:f}},t.getYpid=function(n){var t=n;return t&&(t.ypid||t.businesslistingid)},t.getTransitJson=function(n){var t=n;return t&&t.tj},t.isTransitEntity=function(n){var t=n;return t&&t.representsTransitStop},t.isLandmarkEntity=function(n){var t=n;return t&&t.isLandmark},t}(),wi=function(){function n(){}return n}(),l=function(){function n(n){this._templateName=n}return n.prototype.dispose=function(){},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){t(n)})),this._ready},n.prototype.getBrandTemplates=function(){return null},n.prototype.getCardVectorImageTemplateAsync=function(n){window.setTimeout(function(){n&&n(null)},0)},n.prototype.getCityPolygonTemplates=function(){return null},n.prototype.getLandmarkVectorImageTemplate=function(t,i){var r=n._landmarkTemplates[i];return r?[r]:[]},n.prototype.getMarkupRecord=function(){var t=w.isDarkTheme(this._templateName)?n._darkThemeStyle:n._lightThemeStyle;return{styleStatic:t.styleStatic,styleDynamic:i._copyObject(t.styleDynamic)}},n.prototype.getName=function(){return this._templateName},n.prototype.getPoiVectorImageTemplate=function(t,i,r){var u=n.poiTemplates[r];return u?[u]:[]},n.prototype.getPushpinTextTemplates=function(){return null},n.prototype.getSDKLandmarkImageTemplates=function(){return null},n.prototype.getRoutePoiVectorImageTemplate=function(t,i){var r;return r=t==="turn"?n.directionsTurnTemplate:n.poiTemplates[i],r?[r]:[]},n.prototype.prefetchShields=function(){return new Promise(function(n){n()})},n.prototype.prefetchImagesByBucketIds=function(){return new Promise(function(n){n()})},n.prototype.getFetchedShields=function(t,i,r){var u,f,e;if(i&&r&&r.length){for(u=[],f=0,e=r.length;f<e;f++)u.push(n.DefaultShieldTemplate);return u}return null},n.prototype.getShieldsAsync=function(n,t,i,r){var u=this;window.setTimeout(function(){r&&r(u.getFetchedShields(n,t,i))},0)},n.prototype.getTemplates=function(){return null},n.prototype.setProcessDrawOrder=function(){},n._lightThemeStyle={styleStatic:{backgroundColor:"rgba(236,234,227,0.7)",font:"SegoeBing",fontSize:10},styleDynamic:{visible:!0,fontColor:"#000"}},n._darkThemeStyle={styleStatic:{backgroundColor:"rgba(64,64,64,0.7)",font:"SegoeBing",fontSize:10},styleDynamic:{visible:!0,fontColor:"#fff"}},n._landmarkTemplates=[null,null,new u({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new u({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new u({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1})],n.poiTemplates=[null,null,new u({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new u({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:16,radiusY:16},{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new u({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:2},centerX:0,centerY:0,radiusX:14,radiusY:14},{vectorType:2,style:{fillStyle:"#000"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),new u({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:8,radiusY:8}],hitTest:1}),new u({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:2},centerX:0,centerY:0,radiusX:10,radiusY:10},{vectorType:2,style:{fillStyle:"rgba(0,0,0,0.5)"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),],n.directionsTurnTemplate=new u({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),n.DefaultShieldTemplate=new u({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#666",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:8},{vectorType:3,style:{fillStyle:"#000",font:"SegoeBing",fontSize:7,fontStyle:1,horizontalAutoScaling:1},anchor:{x:0,y:0},maxWidth:18,text:"{MapDisplay}"}]}),n}(),w=function(){function t(r,u,f,e,s,c,l){var v=this,a;this._clientPerf=s;this._poiImagesCache=new h(100);this._templateName=f;this._state=[];this._stlVersion=i._getStlVersion()||e;this._shieldToRoadIdMapping={};this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this._hitTest=c;this._images={};this.ready=new d;n.enableFunctionalTestHooks&&i._getUrlParam(window.location,"teststylefailure")==="1"&&(t._retryTimeout=1);a=o.dynamicProperties.compositionHandlerGenerationId;this._urlFormat=u.replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",a);this._urlImageFormat=r.mapImageTemplateUrlFormat.replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",a);this._drawOrder=new h(i._lowMem()?2:8);this._markupOrder=new h(i._lowMem()?1:4);this._shieldImages={};this._shieldScaleListForZoom={};this._initialized=!1;this._retryCount=0;this._localCatIdVectorImageTemplate={};l&&(this._delayLoadTimerId=window.setTimeout(function(){v.selectorReady()},t._delayLoadTimeout*1e3))}return t.prototype.setProcessDrawOrder=function(n){this.processDrawOrder=n},t.prototype.getName=function(){return this._templateName},t.isDarkTheme=function(n){return!!this._darkTemplates[n]},t.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t,i){n._requestTemplateData(t,i)})),this._ready},t.prototype._requestTemplateData=function(r,u){var f=this,e,v,s,h,l,a;!this._requested&&this._urlFormat&&(this._requested=!0,this._delayLoadTimerId&&(window.clearTimeout(this._delayLoadTimerId),this._delayLoadTimerId=null),e=i._getXsrValue(),e&&(v=location&&location.protocol?location.protocol:"https:",this._urlFormat=v+"//ecn.api.m"+e+".tiles.live-int.com/comp/stl?v="+this._stlVersion+"&responseType=jsonp&callback=Microsoft.Maps.NetworkCallbacks.normal&jsonso="+this._templateName+"&g=3485"),n.logDebugData("BaseMapTemplateSelector - _requestTemplateData() "+this._urlFormat),s=this._clientPerf&&this._clientPerf.start(t._latencyLogKey),h=window[this._templateName],h===undefined||h!==this._templateName||e?h&&!e?(delete window[this._templateName],this._onNetworkResponse(h,s,r)):o.features.jsonXsrResponse.isEnabled?c.downloadJson(this._urlFormat.replace(/{templateName}/g,this._templateName),"styles",function(n){f._onNetworkResponse(n,s,r)},function(){f._onNetworkError(f._templateName,r,u)},null,!1,null,!1):c.downloadJsonp(this._urlFormat.replace(/{subdomain}/g,"0"),"styles",function(n){f._onNetworkResponse(n,s,r)},function(){f._onNetworkError(f._templateName,r,u)},this._templateName):(l="XsrPrefetchCallback",a="XsrPrefetchErrorCallback",window[l]=function(n,t){delete window[t];delete window[a];delete window[l];f._onNetworkResponse(n,s,r)},window[a]=function(n){delete window[n];delete window[a];delete window[l];f._retryCount++;f._onNetworkError(n,r,u)}))},t.prototype._onNetworkError=function(i,r,u){var f=this;this._retryCount<t._maxRetries?(this._requested=!1,this._retryCount++,n.logNetworkData(i,"retry "+this._retryCount),this._delayLoadTimerId=setTimeout(function(){f._requestTemplateData(r,u)},t._retryTimeout*1e3)):n.logNetworkData(i,"max retries");u(null)},t.prototype._onNetworkResponse=function(n,t,i){this._isDisposed||(this._clientPerf&&this._clientPerf.end(t),this._parseTemplate(n,i))},t.prototype._loadTemplates=function(n){if(!this._initialized)throw"BaseMapTemplateSelector: trying to use this class before it has been initialized";this._populateDraworderByZoom(n);this._populateMarkupByZoom(n)},t.prototype._IsCurveGraph=function(n){return typeof n.position!="undefined"&&typeof n.tangentType!="undefined"?!0:!1},t.prototype._IsDiscreateCollectionGraph=function(n){return typeof n.start!="undefined"&&typeof n.end!="undefined"?!0:!1},t.prototype._IsHslaTransformCurveGraph=function(n){return n.graphType===14?!0:!1},t.prototype._IsTransformCurveGraph=function(n){return n.graphType===15&&typeof n.numericTransformCurve!="undefined"?!0:!1},t.prototype._getFixedStringId=function(n){for(var i=-1,t=0,r=this._fixedStrings.length;t<r;t++)if(n===this._fixedStrings[t]){i=t;break}return i},t.prototype._getColorformat=function(n){var i=null,t;return n.graphType===1&&(t=n.value,t&&typeof t=="string"&&t.slice(1).length===6&&!isNaN(parseInt(t.slice(1),16))?i=1:t&&typeof t=="string"&&t.indexOf("rgba")>-1?i=0:(t||t===0)&&typeof t=="number"&&(i=3)),i},t.prototype._parseTemplate=function(i,r){var w=this,dt,lt,gt,ni,ii,rt,vt,b,d,a,yt,h,l,o,ri,e,v,et,ot,g,st,y,ui,pt,p,fi,f,ei,nt,wt,ht,ct;n.time("ParseTemplate");var bt="Smooth",kt="Step",c=i.graphs;if(this._landColor=i.landColor,this._drawOrderList=i.drawOrder,this._shieldStyleResponseData={},i&&i.shields)for(e=0,dt=i.shields.length;e<dt;e++)lt=i.shields[e],this._shieldStyleResponseData[lt.shieldBucketId.toString()]=lt;for(this._passDefinitionList=i.passDefinitions,this._imageGroups=i.imageGroups,this._groupedImageOptions=i.groupedImageOptions,this._state=i.state||[],this._propertyValues=i.propertyValues,this._svgColor=i.svgColor,u.fontFamilies=i.fontFamilies,this._markupOrderList=i.markupOrder,this._computedSplineGraphs=new Array(c.length),this._mapImages=[],this._imgVariants=i.imageVariantsList,this._fixedStrings=i.fixedStrings,this._palette=this._createPalette(i.paletteDefinitions,i.paletteItems),gt=this._getFixedStringId("Global.ImageFamily"),ni=this._palette.getStringPaletteValue(gt),this._paletteFlavorKeyId=this._getFixedStringId(ni),ii=this._getFixedStringId("Default"),p=0,e=0;e<(this._imgVariants&&this._imgVariants.length);e++){for(vt=this._imgVariants[e],f=0;f<vt.imageReferences.length;f++)if(b=vt.imageReferences[f],b.keyId===this._paletteFlavorKeyId){rt=b.imageId;break}else b.keyId===ii&&(rt=b.imageId);this._unmappedToMappedImageIndex[rt]=p;this._mappedToUnmappedImageIndex[p++]=rt}for(this._setStateIndex(),e=0;e<i.visibilityRanges.length;e++)if(d=i.visibilityRanges[e],d)for(f=0;f<d.length;f++)(p=d[f].visibleValueId||0,o=i.booleanValues[p],o)&&(d[f].visible=o.type===1?o.fValue||!1:this._palette.getBooleanPaletteValue(o.pValue));for(this._styleVisibilities=this._getvisibilities(i.drawOrder.visibilityIndex,i.drawOrder.geometry,i.visibilityRanges),this._markupVisibilities=this._getvisibilities(i.markupOrder.visibilityIndex,i.markupOrder.geometry,i.visibilityRanges),e=0;e<c.length;e++)if((a=c[e],a&&!(a.length<1))&&(yt=a[0].graphType,a&&yt))switch(yt){case 1:for(f=0;f<a.length;f++)if(h=a[f],l=typeof h.valueId!="undefined"?h.valueId:h.value,l||l===0){if(o=i.colorValues[l],!o)continue;o.type===1?h.value=o.fValue||0:(h.value=this._palette.getColorPaletteValue(o.pValue,!1),isNaN(h.value)&&(h.value=-1))}break;case 2:for(f=0;f<a.length;f++)if(h=a[f],l=typeof h.valueId!="undefined"?h.valueId:h.value,l||l===0){if(o=i.singleValues[l],!o)continue;h.value=o.type===1?o.fValue||0:this._palette.getSinglePaletteValue(o.pValue)}break;case 16:for(f=0;f<a.length;f++)if(h=a[f],l=typeof h.valueId!="undefined"?h.valueId:h.value,l||l===0){if(o=i.booleanValues[l],!o)continue;h.value=o.type===1?o.fValue||!1:this._palette.getBooleanPaletteValue(o.pValue)}break;case 17:for(f=0;f<a.length;f++)if(h=a[f],l=typeof h.valueId!="undefined"?h.valueId:h.value,l||l===0){if(o=i.stringValues[l],!o)continue;o.type===1?(ri=o.fValue||0,h.value=this._fixedStrings[ri]):h.value=this._palette.getStringPaletteValue(o.pValue)}}for(e=0;e<c.length;e++)if(c[e]&&!(c[e].length<1))if(v=c[e][0],et=this._getColorformat(v),et!==null){for(ot=new it,f=0;f<c[e].length;f++)y=c[e][f],g=new s(y.value,et),ot.addKey(y.position,g.red,g.green,g.blue,g.alpha,y.tangentType===bt?1:y.tangentType===kt?2:0),f+1<c[e].length&&(c[e][f+1].graphType=1,et=this._getColorformat(c[e][f+1]));ot.computeTangents();this._computedSplineGraphs[e]=ot}else if(this._IsCurveGraph(v)){for(st=new tt,f=0;f<c[e].length;f++)y=c[e][f],ui=new at(y.position,y.value,y.tangentType===bt?1:y.tangentType===kt?2:0),st.addKey(ui);st.computeTangents();this._computedSplineGraphs[e]=st}else if(this._IsDiscreateCollectionGraph(v)){for(pt=new k,f=0;f<c[e].length;f++)pt.addRange(c[e][f].start,c[e][f].end,c[e][f].value);this._computedSplineGraphs[e]=pt}else if(this._IsTransformCurveGraph(v))p=v.numericTransformCurve,this._computedSplineGraphs[p]&&(fi=new ut(this._computedSplineGraphs[p]),this._computedSplineGraphs[e]=fi);else if(this._IsHslaTransformCurveGraph(v)){var oi=this._computedSplineGraphs[v.h],si=this._computedSplineGraphs[v.s],hi=this._computedSplineGraphs[v.l],ci=this._computedSplineGraphs[v.a],li=new ft(oi,si,hi,ci);this._computedSplineGraphs[e]=li}for(f=0,ei=this._drawOrderList.bucket.length;f<ei;f++)nt=this._drawOrderList.bucket[f].toString(),wt=this._drawOrderList.passID[f],this._bucketToPassDefinitionIndex[nt]=wt,this._bucketToDrawOrderListIndex[nt]=f,ht=this._getMappedImageIndex(wt),ht>=0&&(this._bucketToMappedImageIndex[nt]=ht),ct=this._mappedToUnmappedImageIndex[ht],this._unmappedIndexToBucketIds[ct]||(this._unmappedIndexToBucketIds[ct]=[]),this._unmappedIndexToBucketIds[ct].push(nt);n.timeEnd("ParseTemplate");this.prefetchImagesByBucketIds([t._haloImageBucket,t.DefaultBucketForLocalCat,t.xsrPoiBucketId,t.pricePoiBucketId,t.xsrPolygonBucketId,t.cityPolygonBucket],!0).then(function(){w._initialized=!0;w._ready=new ti(w);r(w);w.ready&&w.ready.invoke()})},t.prototype._getImageByBucketId=function(n){if(this._images){if(!this._images[n]){var t=this._bucketToMappedImageIndex[n];this._updateCachedImages(this._mappedToUnmappedImageIndex[t])}return this._images[n]}return null},t.prototype._updateCachedImages=function(n){var e=t._mapImagesUnmapped[n],o,s,i,r,f,h;if(e&&(o=this._unmappedToMappedImageIndex[n],!this._mapImages[o]&&(this._mapImages[o]=e,s=e.vectorImage,i=this._unmappedIndexToBucketIds[n],i)))for(r=0;r<i.length;r++)f=i[r],h=this._passDefinitionList[this._bucketToPassDefinitionIndex[f]],this._images[f]={scale:h.scale,scaleTransform:h.scaleTransform,template:s?new u(s):null,visibility:this._styleVisibilities[this._bucketToDrawOrderListIndex[f]]}},t.prototype._createPalette=function(n,t){for(var a,p,g,b,k,rt,o,v,s,w,nt,f,e,c,r,l,u,d,tt=n.nodes,it=n.types,h={},y={},i=0;i<it.length;i++)if(a=it[i],a){for(p=a.parentId,w=this._fixedStrings[a.nameId],h[i]={name:w,properties:[]},p>=0&&(f=h[p],f?h[i].parent=f:y[i]=p),g=a.properties,b=0;b<g.length;b++)(k=g[b],k)&&(rt=this._fixedStrings[k.nameId],h[i].properties.push({propertyName:rt,valueType:k.valueType}));for(u in y)i===y[u]&&(e=h[u],e&&(e.parent=h[i],delete y[u]))}for(o={},v={},i=0;i<tt.length;i++)if((s=tt[i],s)&&(w=this._fixedStrings[s.nameId],nt=h[s.nodeTypeId],nt||!(s.parentId>=0))){o[i]={name:w,nodeType:nt};s.parentId>=0&&(f=o[s.parentId],f?(f.children||(f.children=[]),f.children.push(o[i])):v[i]=s.parentId);for(u in v)i===v[u]&&(e=o[u],e&&(e.children||(e.children=[]),e.children.push(o[i]),delete v[u]))}for(c={},i=0;i<t.length;i++)if(r=t[i],l=this._fixedStrings[r.keyId],r&&l)switch(r.type){case"StringPaletteItem":c[l]={keyId:r.keyId,type:0,stringId:r.stringPaletteItem};break;case"ColorPaletteItem":c[l]={keyId:r.keyId,type:1,value:r.colorPaletteItem.value,ignoreTransform:r.colorPaletteItem.ignoreTransform};break;case"SinglePaletteItem":c[l]={keyId:r.keyId,type:2,value:r.singlePaletteItem.value,ignoreTransform:r.singlePaletteItem.ignoreTransform};break;case"BooleanPaletteItem":c[l]={keyId:r.keyId,type:3,value:r.booleanPaletteItem}}d=new fi(this._templateName,this._fixedStrings);for(u in o)d.populate(o[u],c);return d},t.prototype._getShieldUnmappedImageIndexes=function(n){var s=[],c=this._shieldImages[n],f=this._shieldStyleResponseData[n],e,h,r,t,o,u,i;if(f)for(e=f.passID[0].length,c=new Array(e),h=this._getFixedStringId("Default"),r=0;r<e;r++){for(t=this._computeSplineGraphObject(this._passDefinitionList[f.passID[0][r]].image,1),o=this._imgVariants[t].imageReferences,u=0;u<o.length;u++)if(i=o[u],i.keyId===this._paletteFlavorKeyId){t=i.imageId;break}else i.keyId===h&&(t=i.imageId);s.push(t)}return s},t.prototype._getShieldImages=function(n,i){var r=this._shieldImages[n],h,o,f,e,s;for(r||(r=[]),h=this._getShieldUnmappedImageIndexes(n),f=0;f<h.length;f++){for(e=-1,s=0;s<i.length;s++)if(i[s]===f){e=f;break}(o=t._mapImagesUnmapped[h[f]],o&&o.vectorImage)&&(e===-1||r[e]||(r[e]=new u(o.vectorImage)))}return this._shieldImages[n]=r,r},t.prototype._getShieldScales=function(n,t){var i,u=this._shieldScaleListForZoom[n]||{},s,e,o,r,h;if(u&&(i=u[t]),!i){if(s=Math.round(f.calculateStyleScaleForLod(n)*1e7)/1e7,e=this._shieldStyleResponseData[t],e)for(o=e.passID[0].length,i=new Array(o),r=0;r<o;r++)h=this._computeSplineGraphObject(this._passDefinitionList[e.passID[0][r]].shieldScale,s),i[r]=h;u[t]=i;this._shieldScaleListForZoom[n]=u}return i},t.prototype._populateMarkupByZoom=function(r){var e,ut,s,p,nt,tt,h,it,c,a,l,w,v,y,k,d,b;for(n.time("ParseMarkupOrder"),e=this._markupOrderList,ut=this._passDefinitionList,e.validKeys={},e.keys=e.bucket,s={},p=[],e.templates=new Array(e.passID.length),nt=Math.round(f.calculateStyleScaleForLod(r)*1e7)/1e7,tt=yt.Browser.is_webkit?t._webkitFontFillLightnessFactor:0,h=0,it=e.bucket.length;h<it;h++)c={},a=e.passID[h],p[a]||(p[a]=this._getMarkupOrderTemplate(a,nt,tt)),c.style=p[a],c.visibility=this._markupVisibilities[h],c.priority=e.priority[h],c.globalOrder=h+1,l=e.bucket[h].toString()+","+this._markupVisibilities[h].geometryType,s[l]?s[l].style.styleStatic.secondaryFontSize=c.style.styleStatic.fontSize:s[l]=c;w=t._poiStyles[this._templateName];for(v in w)if(w.hasOwnProperty(v)&&(y=w[v],k=v+",1",s[k]={style:{styleStatic:i._copyObject(y.styleStatic),styleDynamic:y.styleDynamic},priority:y.styleDynamic.priority,globalOrder:y.styleDynamic.globalOrder},d=o.features.taskFramework,d&&d.enablePoiFromXsr)){var l=t.xsrPoiBucketId+",1",g=s[l].style,u=i._copyObject(g.styleStatic),rt=g.styleDynamic.fontColor;u.wrapDisplayName=!0;u.backgroundColor=t.isDarkTheme(this._templateName)?"rgba(64,64,64,0.7)":"rgba(236,234,227,0.7)";switch(v){case t.bucketIdForPoi:s[l]&&(r<16?(u.offsetX=13,u.offsetY=13):r>=16&&r<=19?(u.offsetX=15,u.offsetY=15):(u.offsetX=17,u.offsetY=17));break;case t.bucketIdForSelectedPoi:u.offsetX=24;u.offsetY=24;rt=this._getColor("SelectedPointState"+t._labelColor,!0)}b=s[k].style;b.styleStatic=u;b.styleDynamic.fontColor=rt;b.styleDynamic.outlineColor=g.styleDynamic.outlineColor}this._markupOrder.addItem(""+r,s);n.time("PopulateMarkupOrder");n.timeEnd("ParseMarkupOrder")},t.prototype._getMarkupOrderTemplate=function(n,i,r){var u=this._passDefinitionList[n],c={styleStatic:{font:"",fontSize:0},styleDynamic:{fontColor:"",outlineColor:""}},f=c.styleStatic,w=c.styleDynamic,b,k,l,a,d,e,o,s,v,y,h,p;f.font=this._computeSplineGraphObject(u.fontName,i)||"SegoeBing";var g=this._computeSplineGraphObject(u.fontBold,i),nt=this._computeSplineGraphObject(u.fontSemiBold,i),tt=this._computeSplineGraphObject(u.fontLight,i);f.fontWeight=g?3:nt?2:tt?1:0;b=this._computeSplineGraphObject(u.fontAllCapitals,i);k=this._computeSplineGraphObject(u.fontSmallCaps,i);f.fontCaps=b?2:k?1:0;l=this._computeSplineGraphObject(u.fontColorTransform,i);w.fontColor=l?this._computeHslaTransform(u.fontColor,i,l,r):this._computeSplineGraphObject(u.fontColor,i);f.fontSize=this._computeSplineGraphObject(u.preferedFontSize,i);a=this._computeSplineGraphObject(u.preferedFontSizeTransform,i);a>0&&(f.fontSize*=a);f.fontMinimumSize=this._computeSplineGraphObject(u.minimumFontSize,i);f.pointLabelPlacementPreference=this._computeSplineGraphObject(u.pointPlacement,i);f.polygonFillPreference=this._computeSplineGraphObject(u.areaFillingPreference,i);f.verticalAlignment=this._computeSplineGraphObject(u.lineVerticalAlign,i);f.fontGlow=this._computeSplineGraphObject(u.fontGlow,i);f.fontItalics=this._computeSplineGraphObject(u.fontItalics,i);f.fontOutlined=this._computeSplineGraphObject(u.fontOutlined,i);f.fontUnderlined=this._computeSplineGraphObject(u.fontUnderlined,i);f.glowColor=this._computeSplineGraphObject(u.glowColor,i);f.glowSize=this._computeSplineGraphObject(u.glowSize,i);d=this._computeSplineGraphObject(u.heightMatch,i);switch(d){case"LabelHeightMatchXHeight":e=2;break;case"LabelHeightMatchAscent":e=1;break;default:e=0}return e!==0&&(o=0,s=this._computeSplineGraphObject(u.heightMatchPixels,i),s&&(v=this._computeSplineGraphObject(u.heightMatchPixelsTransform,i),v&&(s*=v),e===1?o=s*t._capHeightRatio:e===2&&(o=s*t._xHeightRatio),o<f.fontSize&&(f.fontSize=o))),y=this._computeSplineGraphObject(u.outlineColorTransform,i),w.outlineColor=y?this._computeHslaTransform(u.outlineColor,i,y):this._computeSplineGraphObject(u.outlineColor,i),f.outlineWidth=this._computeSplineGraphObject(u.outlineWidth,i),f.outlineWidth<2&&(f.outlineWidth+=t._outlineWidthDelta),h={},h.alpha=this._computeSplineGraphObject(u.overrideAlpha,i),h.fontSize=this._computeSplineGraphObject(u.strataFontSize,i),f.strataStyle=h,p=this._computeSplineGraphObject(u.shieldLabelVisibility,i),f.shieldLabelVisibility=p==="Both"?2:p==="NoText"?1:0,c},t.prototype._addRecordStyleString=function(n,t,i){var r,u;typeof n[t]!="undefined"&&(r=this._svgColor[n[t]],r.type!=="SvgFixedColor"&&r.svgPaletteColor.idPair&&r.svgPaletteColor.idPair.length>0&&(u=this._fixedStrings[r.svgPaletteColor.idPair[0].second]),n[i]=u)},t.prototype._resolveRecord=function(n,t,i,r){var u,e,f,o;if(r===void 0&&(r=1),typeof n[t]!="undefined")switch(r){case 1:u=this._svgColor[n[t]];u.type==="SvgFixedColor"?e=u.color:(f=this._palette.getColorPaletteValue(u.svgPaletteColor.idPair[0].second,!1),e=f||f===0?v.convertPackedTorgba(f):u.color||0);n[i]=e;break;case 2:o=this._palette.getSinglePaletteValue(n[t]);n[i]=o}},t.prototype._getDefaultVectorImageTemplate=function(i){var u,r;return this._initialized?(r=t.localCatIdBucketMapping[i],r||(r=t.DefaultBucketForLocalCat),this._images&&r?u=this._getImageByBucketId(r):n.log(null,"Not able to create vector image templates",this._images),u):(n.log(null,"TemplateSelector needs to be initialized before getImage() call",this._initialized),null)},t.prototype._getDefaultVectorImageTemplateAsync=function(i,r){var f=this,u;if(!this._initialized)return n.log(null,"TemplateSelector needs to be initialized before getImage() call",this._initialized),null;u=t.localCatIdBucketMapping[i];u||(u=t.DefaultBucketForLocalCat);this.prefetchImagesByBucketIds([u]).then(function(){r&&r(f._images[u])})},t.prototype.getCardVectorImageTemplateAsync=function(n,r,f,e,o,h,c){var v=this,a,l;if(f=f||s.transparent,e=e||s.black,o=o||.7,a=r+f+e+o.toString(),l=this._localCatIdVectorImageTemplate[a],l&&n){window.setTimeout(function(){n(l)},0);return}this._getDefaultVectorImageTemplateAsync(r,function(r){var w,y,g,nt,p,s,b,k,tt;if(r&&r.template){for(w=r.template.getVectorImage(),y={},y.hotspotX=w.hotspotX,y.hotspotY=w.hotspotY,y.records=[],g=!1,s=0,b=w.records.length;s<b;s++){y.records[s]=i._copyObject(w.records[s]);y.records[s].style={};for(nt in w.records[s].style)y.records[s].style[nt]=w.records[s].style[nt];p=w.records[s].style.fillStylePaletteKey;p&&(g=!0,p.indexOf(t._backgroundColor)>-1||p.indexOf(t._borderColor)>-1||p.indexOf(t._fillColor)>-1||p.indexOf(t._borderStrokeColor)>-1||p.indexOf(t._strokeColor)>-1?y.records[s].style.fillStyle=f:(p.indexOf(t._colorString)>-1||p.indexOf(t._iconColor)>-1)&&(y.records[s].style.fillStyle=e))}if(!g&&v._templateName==="3348DF34-653A-489E-97B3-7371457982E3")for(s=0,b=y.records.length;s<b;s++)k=y.records[s],tt=k.vectorType,tt===2?k.style.fillStyle=f:tt===4&&(k.style.fillStyle=e);if(l=new u(y),l.setScale(o),h){c=c||h;var it=l.getScale(),d=l.getBounds().getSize(),rt=d.width/it,ut=d.height/it;(d.width>h||d.height>c)&&l.setScale(Math.min(h/rt,c/ut))}v._localCatIdVectorImageTemplate[a]=l}window.setTimeout(function(){n&&n(l)},0)})},t.prototype._getPoiImageStyleValue=function(n,t,i){var r=this._getFixedStringId(i+n),u=this._palette.getSinglePaletteValue(r,!0);return isNaN(u)&&(r=this._getFixedStringId(t+n),u=this._palette.getSinglePaletteValue(r,!0)),u},t.prototype._getColor=function(n,t){var r=this._getFixedStringId(n),i=this._palette.getColorPaletteValue(r,t);return isNaN(i)?"":i||i===0?v.convertPackedTorgba(i):s.black},t.prototype._getPoiImageColor=function(n,i,r){var u=this._getColor(r+n,!0),f=!1;return u&&(f=!0),f||(u=this._getColor(i+n,!0),u||i.indexOf("Transit")!==0||(u=t._task4Color[n])),u},t.prototype._getImageScale=function(n,t){var i=1,r;return i=this._computeSplineGraphObject(n.scale,t),r=this._computeSplineGraphObject(n.scaleTransform,t),r>0&&(i=i*r),i},t.prototype._setStateIndex=function(){var t="en-us",n,i;for(this._currentStateIndex=0,n=0;n<this._state.length;n++)if(i=this._state[n].idPair[0],i){var f=this._propertyValues[i.second],u=this._fixedStrings[f.propVal].toLowerCase(),r=o.dynamicProperties.market.toLowerCase();if(r===t&&u===t||r.substr(0,2)!==t.substr(0,2)&&u.substr(0,2)===r.substr(0,2)){this._currentStateIndex=n;break}}},t.prototype._getMappedImageIndex=function(n){var f=this._passDefinitionList[n],t=-1,r,u,i;if(typeof f.imageGroup!="undefined"){if(t=Math.round(this._computeSplineGraphObject(f.imageGroup,1)),r=this._imageGroups[t].images,!r)return t;for(u=0;u<r.length;u++)if(i=this._groupedImageOptions[r[u]],i.stateId==this._currentStateIndex){t=i.mapImage;break}else i.stateId==0&&(t=i.mapImage)}return t},t.prototype._processVectorImage=function(n){var r,u,t,i;if(n){for(r=0,u=n.records.length;r<u;r++)t=n.records[r],this._resolveRecord(t,"fillValueId","fill",1),this._addRecordStyleString(t,"fillValueId","fillStylePaletteKey"),this._resolveRecord(t,"strokeValueId","stroke",1),this._addRecordStyleString(t,"strokeValueId","strokeStylePaletteKey"),this._resolveRecord(t,"colorValueId","color",1),this._addRecordStyleString(t,"colorValueId","colorStylePaletteKey"),this._resolveRecord(t,"scalePaletteKeyId","scale",2),this._resolveRecord(t,"strokeScalePaletteKeyId","strokeScale",2),typeof t.lineStyle!="undefined"&&(this._resolveRecord(t.lineStyle,"colorValueId","color",1),this._addRecordStyleString(t.lineStyle,"colorValueId","colorStylePaletteKey")),i=t,typeof i.stringSourceType!="undefined"&&(this._resolveRecord(i.textStyle,"colorValueId","color",1),i.textStyle.fontFamily=this._fixedStrings[i.textStyle.fontFamilyId]);n.hitTest=1}},t.prototype._parseImageRecord=function(n){var u,t,i,r;if(n)return(u={},t=n.vectorImage,this._processVectorImage(t),i=n.bitmapImage,t)?n:i?(r=document.createElement("img"),r.src=i,r):null},t.prototype.getRoutePoiVectorImageTemplate=function(n,i,r){var w=t.directionIconTypeBuckets[n],g=t._poiStateNames[i],b="d"+w+g+r.toString(),e=this._poiImagesCache.getItem(b),v,o,s,y,h,a,k,d;if(e)return e;if(e=[],v=Math.round(f.calculateStyleScaleForLod(r)*1e7)/1e7,i===4||i===6){switch(n){case"start":o="#1fa94a";s="rgba(227,231,204,0.5)";break;default:o="#4c97ec";s="rgba(204,230,255,0.5)";break;case"end":o="#de2525";s="rgba(248,211,211,0.5)"}(o||s)&&(y=this._getHaloImage(v,function(){return n==="turn"?1.25:1.5},function(){return o},function(){return s},function(){return o}),y&&e.push(y))}if(h=this._getImageByBucketId(w),h&&h.template){var nt=this._getImageScale(h,v),c=h.template.getVectorImage(),p={hitTest:1,hotspotX:undefined,hotspotY:undefined,records:[]};for(a=0,k=c.records.length;a<k;a++)p.records[a]=t._cloneObject(c.records[a]);i===5&&c.records&&c.records.length>1&&c.records[1].style&&(p.records[1].style.fillStyle="#727272");d=new u(p,nt);e.push(d);this._poiImagesCache.addItem(b,e)}return e.length===0&&(e=n==="turn"?[l.directionsTurnTemplate]:[l.poiTemplates[i]]),e},t.prototype._getHaloImage=function(n,r,f,e,o,s,h){var ft,w,p,d,ot,v,y,it,g,st,rt,b,nt,ut,tt,l,a,c;if(s===void 0&&(s=1),h===void 0&&(h=!0),w=this._images[s===2?t.pricePoiBucketId:t._haloImageBucket],w&&w.template){p={};p.hitTest=1;p.records=[];var ht=this._getImageScale(w,n),et=1,k=w.template.getVectorImage();for(p.hotspotX=k.hotspotX,p.hotspotY=k.hotspotY,d=0,ot=k.records.length;d<ot;d++)if(v=k.records[d],v.vectorType!==3||h){for(y=i._copyObject(v),p.records.push(y),v.scale>0&&(c=r&&r(),c>=0&&(y.scale=c,et=c)),y.style={},it=Object.keys(v.style),g=0,st=it.length;g<st;g++)rt=it[g],y.style[rt]=v.style[rt];for(b=[],b.push(v.style.strokeStylePaletteKey),b.push(v.style.fillStylePaletteKey),nt=0;nt<b.length;nt++)ut=b[nt],ut&&(tt=ut.split("."),tt.length>1&&(l="."+tt[tt.length-1],(l===t._highlightBorderColor||l===t._borderColor)&&(a=f&&f(l),a&&(y.style.strokeStyle=a)),(l===t._highlightStrokeColor||l===t._strokeColor)&&(a=o&&o(l),a&&(y.style.strokeStyle=a)),(l===t._highlightFillColor||l===t._fillColor)&&(a=e&&e(l),a&&(y.style.fillStyle=a))))}c=ht*et;c===1.0666666177777648?c=1.084:c===1.15&&(c=1.16);c&&(ft=new u(p,c))}return ft},t.prototype.getLandmarkVectorImageTemplate=function(n,i,r){var e=this,l=n.bucket,s=t._poiStateNames[i],h=l+s+r.toString(),u=this._poiImagesCache.getItem(h);if(u||(u=this.getTemplates(n,r),!u))return u;if(i===3||i==4){var a=!!g.getTransitJson(n.entity),o=a?"Transit":"Business",v=this._scaleToZoom(r),y=Math.round(f.calculateStyleScaleForLod(v)*1e7)/1e7,c=this._getHaloImage(y,function(){return e._getPoiImageStyleValue(t._highlightScale,o,s)},function(n){return e._getColor(o+n,!0)},function(n){return e._getColor(o+n,!0)},function(n){return e._getColor(o+n,!0)});c&&u.unshift(c)}return this._poiImagesCache.addItem(h,u),u},t.prototype.getPoiVectorImageTemplate=function(n,r,e,o,h,c){var nt=this,a,v,ut,p,tt,ft,b,g,it,ct,et,d,y,lt,rt,ot,k,w,st,ht;if(h===void 0&&(h=1),c===void 0&&(c=!0),a=t._taskList[r],v=h===2?t._pricePoiStateNames[e]:t._poiStateNames[e],(e===5||e===6)&&h===2&&(c=!1),ut=n+v+a.toString()+o.toString()+"_PT"+h+c,p=this._poiImagesCache.getItem(ut),p)return p;if(p=[],tt=Math.round(f.calculateStyleScaleForLod(o)*1e7)/1e7,ft=this._getHaloImage(tt,function(){return nt._getPoiImageStyleValue(h===1?t._highlightScale:t._scale,a,v)},function(n){return nt._getPoiImageColor(n,a,v)},function(n){return nt._getPoiImageColor(n,a,v)},function(n){return nt._getPoiImageColor(n,a,v)},h,c),ft&&p.push(ft),b={},b.hitTest=1,b.records=[],g=h!==2||!c?this._getDefaultVectorImageTemplate(n):null,g&&g.template){for(it=1,t._transitCatIds.indexOf(n)>-1?(ct=this._getImageByBucketId(t._transitBucketForScaling)||g,it=this._getImageScale(ct,tt)):it=this._getImageScale(g,tt),et=1,d=g.template.getVectorImage(),y=0,lt=d.records.length;y<lt;y++){b.records[y]=i._copyObject(d.records[y]);d.records[y].scale&&(rt=this._getPoiImageStyleValue(t._backgroundScale,a,v),rt>=0&&(b.records[y].scale=rt,et=rt));b.records[y].style={};for(ot in d.records[y].style)b.records[y].style[ot]=d.records[y].style[ot];k=d.records[y].style.fillStylePaletteKey;w=null;k&&(k.indexOf(t._backgroundColor)>-1?w=this._getPoiImageColor(t._backgroundColor,a,v):k.indexOf(t._borderColor)>-1?w=this._getPoiImageColor(t._borderColor,a,v):k.indexOf(t._colorString)>-1?w=this._getPoiImageColor(t._colorString,a,v):k.indexOf(t._fillColor)>-1?w=h===2?s.transparent:this._getPoiImageColor(t._fillColor,a,v):k.indexOf(t._borderStrokeColor)>-1?w=this._getPoiImageColor(t._borderStrokeColor,a,v):k.indexOf(t._iconColor)>-1?w=this._getPoiImageColor(t._iconColor,a,v):k.indexOf(t._strokeColor)>-1&&(w=this._getPoiImageColor(t._strokeColor,a,v)),w&&(b.records[y].style.fillStyle=w))}st=new u(b);st.setScale(it*et);p.push(st);this._poiImagesCache.addItem(ut,p)}return p.length===0&&(ht=l.poiTemplates[e],p=ht?[ht]:[]),p},t.prototype.getCityPolygonTemplates=function(n,i,r){var c=null,f=t._taskList[i],e=t._poiStateNames[r],l,v;if(n===t.cityPolygonBucket||n===t.xsrPolygonBucketId){var o=0,h=0,u=this._getPoiImageColor(t._highlightBorderColor,f,e);u||(u=this._getPoiImageColor(t._highlightStrokeColor,f,e));r===2?(o=5,h=2):r===5&&(o=4,h=1.5,u=this._getPoiImageColor(t._borderColor,f,e),u||(u=this._getPoiImageColor(t._strokeColor,f,e)));u&&(l=new a({strokeStyle:s.white,fillStyle:s.transparent,lineWidth:o}),v=new a({strokeStyle:u,fillStyle:s.transparent,lineWidth:h}),c=[l,v])}return c},t.prototype.getPushpinTextTemplates=function(n,i,r,f){var s=[],e={style:{fillStyle:"rgb(255,255,255)",font:"Arial, Helvetica, Sans-Serif",fontStyle:1,fontSize:11.25,horizontalAutoScaling:1},text:"{MapDisplay}",anchor:{x:0,y:0},vectorType:3,scale:1},o,c,l;if(i){var a=i.height,h=i.width,y=f.x,p=f.y,v={pointsList:[{x:0,y:0},{x:h,y:0},{x:h,y:a},{x:0,y:a}],vectorType:0,style:{fillStyle:"rgba(255,255,255,0)"},scale:1};e.maxWidth=h;e.style.fontSize=10;e.anchor.x=r.x;e.anchor.y=r.y;o={records:[v,e],hitTest:1};s=[new u(o,1,f)]}else c=n.getVectorImage().records,l=t._cloneObject(c[c.length-1]),e.maxWidth=l.radiusX*2/1.414,o={records:[l,e],hitTest:1},s=[new u(o,n.getScale())];return s},t.prototype.getTemplates=function(i,r){var p=null,w=this._scaleToZoom(r),b=Math.round(f.calculateStyleScaleForLod(w)*1e7)/1e7,a,u,h,k,o,c,s,d,e,v,l,y;if(!this._initialized)return n.log(null,"TemplateSelector needs to be initialized before getTemplates() call",this._initialized),null;if(a=!1,u=this._getImageByBucketId(i.bucket),u&&u.template&&u.visibility){for(h=u.visibility.drawingStyleVisibilities[i.geometryType],k=h.length||0,o=0;o<k;o++)w>=h[o].zoom&&(a=h[o].visible);if(a){for(c=u.template.getVectorImage(),s=0,d=c.records.length;s<d;s++)e=c.records[s].style.fillStylePaletteKey,v=this._getColor(e,!1),v&&e&&(e.indexOf(t._backgroundColor)>-1||e.indexOf(t._borderColor)>-1||e.indexOf(t._colorString)||e.indexOf(t._fillColor))&&(c.records[s].style.fillStyle=v);l=this._computeSplineGraphObject(u.scale,b);y=this._computeSplineGraphObject(u.scaleTransform,b);y>0&&(l=l*y);u.template.setScale(l);p=[u.template]}}return p},t.prototype._populateDraworderByZoom=function(t){var h,l,s,g,k,tt,it,c,i,d,o;if(this.processDrawOrder){n.time("ParseDrawOrder");var r=this._passDefinitionList,v=new Array(r.length),y={bucket:this._drawOrderList.bucket,style:this._drawOrderList.passID,validKeys:{},keys:this._drawOrderList.bucket,templates:new Array(this._drawOrderList.passID.length),visibilities:new Array(this._drawOrderList.passID.length)},e=Math.round(f.calculateStyleScaleForLod(t)*1e7)/1e7,p=0;for(i=0,d=r.length;i<d;i++){if(h={},r[i].arrowHeadLength){var ot=this._computeSplineGraphObject(r[i].arrowHeadLength,e)||0,w=[],b=this._computeSplineGraphObject(this._passDefinitionList[i].bitPattern,e),rt=this._computeSplineGraphObject(this._passDefinitionList[i].patternRepeat,e);if(b>0){b=Math.floor(b);var ut=!1,ft=0,et=b.toString(2).length;for(l=0;l<et;l++)ut=(b>>l&1)!=1,ft++,ut&&w.push(ft);w.length===0&&et>0&&w.push(l);l<rt&&w.push(rt-l);h.dashes=w}ot>0?(s={},c=this._computeSplineGraphObject(r[i].arrowHeadCode,e),s.arrowHeadParts=c==="ArrowHeadEnumBoth"?3:0,s.arrowShaftLength=this._computeSplineGraphObject(r[i].arrowLength,e)||0,s.arrowShaftSpacing=this._computeSplineGraphObject(r[i].arrowSpacing,e)||0,s.arrowHeadLength=this._computeSplineGraphObject(r[i].arrowHeadLength,e)||0,s.arrowAngle=this._computeSplineGraphObject(r[i].arrowAngle,e),s.arrowAngleFill=this._computeSplineGraphObject(r[i].arrowAngleFill,e)||0,s.arrowHeadStrokeWidth=this._computeSplineGraphObject(r[i].arrowHeadStrokeWidth,e),s.strokeStyle=this._computeSplineGraphObject(r[i].penColor,e),s.lineWidth=this._computeSplineGraphObject(r[i].penWidth,e),v[p]=new lt(s)):(r[i].penColor&&(c=this._computeSplineGraphObject(r[i].penColor,e),h.fillStyle=c),r[i].penWidth&&(c=this._computeSplineGraphObject(r[i].penWidth,e),h.lineWidth=c),h.hitTest=this._hitTest?1:0,v[p]=new a(h))}else if(this._mapImages&&typeof r[i].bitmap!="undefined")if(o=Math.round(this._computeSplineGraphObject(r[i].bitmap,e)),o==-1&&(o=0),this._mapImages[o]||this._updateCachedImages(this._mappedToUnmappedImageIndex[o]),o>=0&&o<this._mapImages.length){if(g=this._mapImages[o],k=g,!g)continue;tt=this._computeSplineGraphObject(r[i].scale,e);k.vectorImage?(k.vectorImage.hitTest=k.vectorImage.hitTest?1:this._hitTest?1:0,v[p]=new u(k.vectorImage,tt)):v[p]=new nt(g,tt)}else throw"Image index is out of bounds";else it=this._computeSplineGraphObject(this._passDefinitionList[i].fillImage,e),o=it!==null?Math.round(it):-1,o>=0&&o<this._mapImages.length&&(h.fillImage=this._mapImages[o]),r[i].fillStyle&&(c=this._computeSplineGraphObject(r[i].fillStyle,e),h.fillStyle=c),h.hitTest=this._hitTest?1:0,v[p]=new a(h);p++}for(i=0,d=this._drawOrderList.bucket.length;i<d;i++)y.validKeys[y.keys[i]=y.bucket[i].toString()]=!0,o=this._drawOrderList.passID[i],y.templates[i]=v[o],y.visibilities[i]=this._styleVisibilities[i];this._drawOrder.addItem(""+t,y);n.time("PopulateDraworder");n.timeEnd("ParseDrawOrder")}},t.prototype._getvisibilities=function(n,t,i){for(var u,nt,w,s,h,tt,b,e,c,r,it,d,p,a,g=[],rt=n.length,o=0;o<rt;o++){u={drawingStyleVisibilities:{}};switch(t[o]){case 0:u.geometryType=1;break;case 2:u.geometryType=2;break;case 3:u.geometryType=3}nt=n[o];for(w in nt){s=[];u.densityLodCollection=new k;switch(w){case"point":h=1;break;case"line":h=2;break;case"polygon":h=3}for(tt=n[o][w],b=i[tt],e=0;e<b.length;e++)r={visible:!1},c=b[e],r.densityDistance=c.densityDistance,r.densityImportance=c.densityImportance,r.visible=c.visible,r.zoom=Math.round(f.calculateZoomforStyleScale(c.startZoomLevel)),s.push(r);var v=f.markupVisible,y=1,l=0;if(h===u.geometryType)for(e=s.length-1;e>=0;e--){if(r=s[e],l=Math.round(f.calculateStyleScaleForLod(r.zoom)*1e7)/1e7,it=r.densityDistance===0&&r.densityImportance===0,it)u.densityLodCollection.addRange(l,y,v);else{for(d=(y-l)/f.zoomDeltaBetweenLods,p=v+d,a=l;a<y;a+=f.zoomDeltaBetweenLods)u.densityLodCollection.addRange(a,a+f.zoomDeltaBetweenLods,p),p=p-1;v+=d}y=l;r.densityLodDelta=v}u.drawingStyleVisibilities[h]=s}g.push(u)}return g},t.prototype._computeHslaTransform=function(n,i,r,u){var o,e,s,f,h;return this._computedSplineGraphs&&(e=this._computedSplineGraphs[n],e&&(s=e.evaluateHsla(i),f=v.applyHslaTransform(s,r),u&&f.z<.7&&(f.z*=u),h=v.hslaTorgba(f.x,f.y,f.z,f.w*t._alphaTransformCoefficient),o=h.toRgba())),o},t.prototype._computeSplineGraphObject=function(n,t){var r=null,i;if(this._computedSplineGraphs)return i=this._computedSplineGraphs[n],i instanceof tt?r=i.evaluate(t):i instanceof it?r=i.evaluate(t).toRgba():i instanceof k?r=i.evaluate(t):i instanceof ut?r=i.evaluate(t):i instanceof ft&&(r=i.evaluate(t)),r},t.prototype._intersect=function(n,t){var r=n.crs,b=n.geometry,u=r.getMatrix&&r.getMatrix(t.crs),o,s,h,c,i=b.bounds,f=t.bounds,k=f[0],d=f[1],g=f[2],nt=f[3],p,w;if(u)o=u.projectY(i[3],i[0]),s=u.projectY(i[1],i[2]),h=u.projectX(i[3],i[0]),c=u.projectX(i[1],i[2]);else{var l=r.toLatitude(i[3],i[0]),a=r.toLongitude(i[3],i[0]),v=r.toLatitude(i[1],i[2]),y=r.toLongitude(i[1],i[2]),e=t.crs;o=e.projectToY(l,a);s=e.projectToY(v,y);h=e.projectToX(l,a);c=e.projectToX(v,y)}return p=rt.fromSides(h,c,o,s),w=rt.fromSides(nt,d,k,g),p.intersects(w)},t.prototype.getDrawOrderList=function(t){n.groupCollapsed(null,"Getting drawOrder List for scale: {0}",t.toString());var i=Math.round(this._scaleToZoom(t)),r=this._drawOrder.getItem(""+i);return r||(n.log(null,"Draworder list not available for zoom: {0}, loading templates",i),this._loadTemplates(i),r=this._drawOrder.getItem(""+i)),n.assert(!this.processDrawOrder||!!r,"BaseMapTemplateSelector.getDrawOrderList: Draworder list not available for zoom: "+i),n.logObject(null,"Result",r),n.groupEnd(),r},t.prototype.indexPrimitives=function(t,i,r){var f,o,h,s,e,u,c;if(n.groupCollapsed(null,"Index primitives"),f={},o=this.getDrawOrderList(r),n.logObject(null,"drawOrderList",o),o)for(h=o.validKeys,s=0;s<t.length;s++)e=t[s],u=e.bucket,h[u]||(u=this._shieldToRoadIdMapping[u],e.bucket=u),h[u]&&this._intersect(e,i)&&(c=f[u]=f[u]||[],c.push(e));return n.logObject(null,"indexed",f),n.groupEnd(),f},t.prototype.getLandColor=function(){return this._landColor[0].value},t.prototype._getMarkupOrderList=function(t){var i=Math.round(this._scaleToZoom(t)),r;return n.groupCollapsed(null,"Get markup order list for zoom: {0}",i.toString()),r=this._markupOrder&&this._markupOrder.getItem(""+i),n.groupEnd(),null},t.prototype._getOriginalBucketId=function(n){var t=Math.floor(parseInt(n)&65535);return t.toString()},t.prototype.getMarkupRecord=function(i,r,u,f){var l,e,s,h,a,c;if(r){var i=Math.round(i),o=this._markupOrder.getItem(""+i);if(o||(this._loadTemplates(i),o=this._markupOrder.getItem(""+i)),n.assertNotNull(o,"no markup order for zoom "+i),e=o[r+","+u],!e){if(l=r,r=this._getOriginalBucketId(r),n.assert(r!=null,"failed to map bucketId "+l),!r)return;e=o[r+","+u]}if(e){if(s=this._computeStyleDynamic(e,u,i),s){if(f){h=2;switch(f){case 1:h=3;break;case 2:h=4}a=t._poiStateNames[h];c=this._getColor(a+t._labelColor,!0);c&&s&&(s.fontColor=c)}return{styleStatic:e.style.styleStatic,styleDynamic:s}}return}}},t.prototype._computeStyleDynamic=function(n,t,i){var f=n.style.styleDynamic||{},e=f.visible,h=f.densityDistance,c=f.densityImportance,l=f.densityLodDelta,u,a,o,s,r;if(n.visibility){for(u=n.visibility.drawingStyleVisibilities[t],a=u.length,r=0;r<a;r++)i>=u[r].zoom&&(o=u[r],e=o.visible,h=o.densityDistance,c=o.densityImportance,l=o.densityLodDelta);if(t===3){for(s=!1,u=n.visibility.drawingStyleVisibilities[2],r=0;r<u.length;r++)i>=u[r].zoom&&(s=u[r].visible);(e||s)&&(e=!0)}}return e?{visible:e,densityDistance:h,densityImportance:c,densityLodDelta:l,priority:n.priority,fontColor:f.fontColor,outlineColor:f.outlineColor,globalOrder:n.globalOrder}:undefined},t.prototype.prefetchShields=function(n,i){var r=this;return i===void 0&&(i=3),new Promise(function(u){for(var v,l,s,f,h,a=[],e={},o=0;o<n.length;o++)for(v=r._getShieldUnmappedImageIndexes(n[o].bucketId),l=n[o].indexes,s=0;s<l.length;s++)f=v[l[s]],f>=0&&(t._mapImagesUnmapped[f]?r._updateCachedImages(f):e[f]||(e[f]=!0));for(h in e)e.hasOwnProperty(h)&&a.push(new Promise(function(u){var f=r._urlImageFormat.replace(/{imageIdx}/g,h);c.downloadJson(f,"XsrImages",function(n,i){var f=r._parseImageRecord(n[i]);t._mapImagesUnmapped[parseInt(i)]=f;r._mapImages[r._unmappedToMappedImageIndex[i]]=f;u()},function(){i>0&&window.setTimeout(function(){r._isDisposed||r.prefetchShields(n,--i)},200);u()},h,!1,0,!1)}));Promise.all(a).then(function(){u()})})},t.prototype.prefetchImagesByBucketIds=function(n,i,r){var u=this;return r===void 0&&(r=3),new Promise(function(f){for(var w,o,b,s,k,l,a,d=[],v=0,h,y=!1,e={},p=0;p<n.length;p++)h=n[p],u._bucketToMappedImageIndex[h]>=0&&(w=u._bucketToMappedImageIndex[h],o=u._mappedToUnmappedImageIndex[w],t._mapImagesUnmapped[o]&&u._updateCachedImages(o),b=u._mapImages[w],y=y||!b,(!b||i)&&(e[o]||(v++,e[o]=[],e[o][0]=[]),e[o][0].push(h)));if(y){if(i&&v>1){s="";k=[];for(l in e)e.hasOwnProperty(l)&&(k.push(e[l][0]),s!==""&&(s+=","),s+=l);v=1;e={};e[s]=k}for(a in e)e.hasOwnProperty(a)&&d.push(new Promise(function(f){var e=u._urlImageFormat.replace(/{imageIdx}/g,a);c.downloadJson(e,"XsrImages",function(n,i){for(var o,s,e=i.split(","),r=0;r<e.length;r++)o=parseInt(e[r]),s=u._parseImageRecord(n[e[r]]),t._mapImagesUnmapped[o]=s,u._updateCachedImages(o);f()},function(){r>0&&window.setTimeout(function(){u._isDisposed||u.prefetchImagesByBucketIds(n,i,--r)},200);f()},a,!1,0,!1)}))}Promise.all(d).then(function(){f()})})},t.prototype.getFetchedShields=function(n,t,i){var f,e,h,u,r;if(!t||!i||!i.length)return null;var n=Math.round(n),o=this._getShieldImages(t,i),s=[];if(o)for(f=this._getShieldScales(n,t),e=0,h=i.length;e<h;e++)u=i[e],r=null,u>=0&&(r=o[u],r&&f&&f[u]&&r.setScale(f[u]),r||(r=l.DefaultShieldTemplate)),s.push(r);return s},t.prototype.getShieldsAsync=function(n,t,i,r){var f=this,u;r&&(u={bucketId:t,indexes:i},this.prefetchShields([u]).then(function(){r(f.getFetchedShields(n,t,i))}))},t.prototype.getSDKLandmarkImageTemplates=function(n,i,r){var f,u,e;return this._v7VenueMapIconProcessed||r||this._showV7HiddenBuckets(),f=n.getState&&n.getState()||2,u=this.getLandmarkVectorImageTemplate(n,f,et.toScale(null,i,!0)),n.entity.isVenueMapPoi&&(e=t._v7BucketsToShow.indexOf(n.bucket)>=0?Math.max(0,Math.min(1.2-(20-i)/10,1.1)):Math.max(0,Math.min(.7-(20-i)/10,.6)),u&&u.length>0&&u[u.length-1].setScale(e)),u},t.prototype.dispose=function(){this._shieldStyleResponseData=null;this._computedSplineGraphs=[];this._markupOrder.clear();this._styleVisibilities=[];this._passDefinitionList=[];this._markupVisibilities=[];this._images=null;this._imgVariants=[];this._markupOrderList=null;this._palette=null;this._drawOrderList=null;this._mapImages=[];this._svgColor=[];this._imageGroups=[];this._groupedImageOptions=[];this._fixedStrings=[];this._shieldImages=null;this._shieldScaleListForZoom=null;this._state=[];this._urlFormat=null;this._propertyValues=[];this._drawOrder.clear();this._poiImagesCache.clear();this._localCatIdVectorImageTemplate=null;this._shieldToRoadIdMapping=null;this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this.ready&&this.ready.dispose();window.clearTimeout(this._delayLoadTimerId);this._isDisposed=!0},t.prototype._scaleToZoom=function(n){return et.fromScale(null,n,!0)},t.prototype._showV7HiddenBuckets=function(){for(var i,r,u,n=0;n<t._v7BucketsToShow.length;n++)if(i=this._getImageByBucketId(t._v7BucketsToShow[n]),r=i&&i.visibility&&i.visibility.drawingStyleVisibilities[1],r)for(u=0;u<r.length;u++)r[u].visible=!0;this._v7VenueMapIconProcessed=!0},t._cloneObject=function(n){var i,r,t,f,u;if(!n||typeof n!="object")return n;for(i={},r=Object.keys(n),t=0,f=r.length;t<f;t++)u=r[t],i[u]=this._cloneObject(n[u]);return i},t.prototype.getBrandTemplates=function(n,i,u,f){var l,e;this._brandTemplatesCache||(this._brandTemplatesCache=new h(100));t._brandImageCache||(t._brandImageCache=new h(20));var v=f<13&&u!=4,y=n+(v?"s":""),b=u.toString()+i+y,o=this._brandTemplatesCache.getItem(b);if(o)return o;var k=v?2/3:1,p=12,s=p*k,a=t._brandImageCache.getItem(y);a||(a=new nt(r.ImageFromCssHelper.getImageFromCss("brand_"+n),k,new r.Anchor(p,p,1)),t._brandImageCache.addItem(y,a));var d=t._taskList[i],g=t._poiStateNames[u],c=s+(v?5:4),tt=t._highlightBorderColor,w=1;switch(u){case 4:w=2;tt=t._colorString;break;case 2:c=s+2;break;case 5:c=s}return l=[],c>s&&l.push(t._squareRecord(c,this._getPoiImageColor(t._highlightFillColor,d,g))),l.push(t._squareRecord(s,"#FFFFFF")),e=c+w/2,l.push({pointsList:[{x:-e,y:-e},{x:e,y:-e},{x:e,y:e},{x:-e,y:e},{x:-e,y:-e}],vectorType:1,style:{lineWidth:w,strokeStyle:this._getPoiImageColor(tt,d,g)}}),o=[new r.VectorImageTemplate({records:l,hotspotX:0,hotspotY:0,hitTest:1}),a],this._brandTemplatesCache.addItem(b,o),o},t._squareRecord=function(n,t){return{pointsList:[{x:-n,y:-n},{x:n,y:-n},{x:n,y:n},{x:-n,y:n}],vectorType:0,style:{fillStyle:t}}},t._mapImagesUnmapped=[],t._colorString=".Color",t._backgroundColor=".BackgroundColor",t._borderColor=".BorderColor",t._backgroundScale=".BackgroundScale",t._highlightBorderColor=".HighlightBorderColor",t._highlightFillColor=".HighlightFillColor",t._highlightScale=".HighlightScale",t._scale=".Scale",t._highlightBorderWidthScale=".HighlightBorderWidthScale",t._labelColor=".LabelColor",t._fillColor=".FillColor",t._borderStrokeColor=".BorderStrokeColor",t._iconColor=".IconColor",t._strokeColor=".StrokeColor",t._highlightStrokeColor=".HighlightStrokeColor",t._poiStateNames=["","Micro","Macro","HoverPointState","SelectedPointState","InactivePointState","InactiveSelectedPointState",],t._pricePoiStateNames=["","Micro","Macro","HoverPointState2","SelectedPointState2","InactivePointState2","InactiveSelectedPointState2",],t.DefaultBucketForLocalCat="357",t._taskList=["Task1","Task2","Task3","Transit","Favorite"],t._haloImageBucket="1372",t.cityPolygonBucket="879",t.localCatIdBucketMapping={"91648":"288","90014":"300","91616":"257","90954":"277","90133":"278","90122":"279","90243":"284","91563":"329","90650":"1365","91533":"271","91649":"281","90948":"1366","90903":"274","90024":"303","90386":"1367","90188":"295","91485":"1368","90727":"306","90859":"325","90089":"276","91538":"296","90298":"318","90738":"67","91348":"309","91572":"287","90320":"297","90837":"313","90045":"273","90016":"304","90960":"1369","91271":"319","90925":"275","90804":"270","90331":"320","90342":"272","90287":"286","90199":"294","90771":"305","91548":"324","91549":"118","91550":"307","91493":"299","90871":"326","90034":"302","90012":"280","91510":"1381","90017":"301","90595":"311","90001":"258","90078":"330","91186":"327","91204":"308","91714":"66","90977":"331","90584":"310","91627":"68","91391":"316","91259":"321","91537":"323","91774":"70","91773":"71","91499":"312","91651":"328","90540":"315","91764":"67","91768":"69","90496":"314","91762":"113","91643":"114","90848":"322","91650":"1359","90942":"317","91621":"64","90892":"1899","91600":"1380","100000":"248","203":"248","255":"254","257":"253","251":"252","253":"251","254":"250","252":"249","91754":"65","205":"247","204":"246","207":"245","206":"244","200":"240","264":"243","265":"242","263":"241","250":"239","202":"238","266":"236","261":"235","91571":"50","201":"234","262":"232","256":"231","260":"229","259":"228","258":"227","267":"226"},t._transitCatIds=["203","255","257","251","253","254","252","91754","205","204","207","206","200","264","265","263","250","202","266","261","91571","201","262","256","260","259","258","267"],t._transitBucketForScaling="1388",t._task4Color={".BackgroundColor":"rgba(47, 163, 235, 255)",".BorderColor":"rgba(121, 186, 226, 255)",".Color":"rgba(255, 255, 255, 255)",".HighlightBorderColor":"rgba(47, 163, 235, 255)",".HighlightFillColor":"rgba(208,227,247, 180)"},t._v7BucketsToShow=["647","648","649","650","651","652","653","689","690","691","692","693","694","695","696","697","698","700","701","702","703","704","706","707","708","709","711","712","713","714","716","717","718","719","720","721","722","723","724","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","771","798","807","809","811","812","813","819","823","826","910","914","915","996","1240","1248","1249","1253","1264","1265","1266","1281","1285","1296","1297","1298","1299","1300","1301","1302"],t.directionIconTypeBuckets={start:"352",middle:"350",via:"1387",turn:"1386",end:"351",ferry:"339",walk:"341",bus:"342",train:"338",airline:"340",tube:"338",auto:"337"},t.poiStylePriorityGroup=999999,t.pricePoiBucketId="1901",t.bucketIdForPoi="999999",t.bucketIdForSelectedPoi="999998",t.bucketIdForTransientLensTop="999997",t.bucketIdForTransientLensBottom="999997.5",t.bucketIdForTransientLensLeft="999997.6",t.bucketIdForTransientLensRight="999997.7",t.bucketIdForDirectionsPins="999996",t.landmarksOffset=new gt(12,12),t.xsrPoiBucketId="357",t.xsrPolygonBucketId="1383",t._roadPoiStyle={"999999":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"1901":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"999998":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:2,visible:!0,priority:t.poiStylePriorityGroup}},"999997":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.5":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.6":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.7":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999996":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}}},t._aerialPoiStyle={"999999":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"1901":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"999998":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:2,visible:!0,priority:t.poiStylePriorityGroup}},"999997":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.5":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.6":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.7":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999996":{styleStatic:{font:"SegoeBing",fontSize:10,fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}}},t._poiStyles={"3348DF34-653A-489E-97B3-7371457982E3":t._roadPoiStyle,"7D2AB870-635B-42F0-A05E-1B07E3F15BEC":t._roadPoiStyle,"097A0D85-2585-425A-8471-60BDD3C5B7C3":t._roadPoiStyle,"A78CB71D-32CA-4F6D-8827-09680717E455":t._roadPoiStyle,"DCD31B1C-B637-4B36-8635-829DF5E46999":t._roadPoiStyle,"DC2B2930-4CA4-45EB-9EE9-3F4EFA4267E5":t._roadPoiStyle,"8CCEE531-6C9C-45AD-9F30-ACE9C310A8B6":t._aerialPoiStyle,"7443EAC9-CD76-4236-B027-22DBC504BF06":t._aerialPoiStyle,"28230F7D-6FAF-49B9-9ED5-254D2E2B8123":t._aerialPoiStyle,"A3A1C843-30CE-4828-984C-AD44EAF2A245":t._aerialPoiStyle,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":t._aerialPoiStyle,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":t._aerialPoiStyle},t._darkTemplates={"8CCEE531-6C9C-45AD-9F30-ACE9C310A8B6":!0,"7443EAC9-CD76-4236-B027-22DBC504BF06":!0,"28230F7D-6FAF-49B9-9ED5-254D2E2B8123":!0,"A3A1C843-30CE-4828-984C-AD44EAF2A245":!0,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":!0,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":!0},t._latencyLogKey="MC_TD_NL",t._delayLoadTimeout=60,t._maxRetries=5,t._retryTimeout=10,t._alphaTransformCoefficient=1.5,t._outlineWidthDelta=1,t._xHeightRatio=1.15385,t._capHeightRatio=.93752,t._webkitFontFillLightnessFactor=.85,t}(),ui=function(){function n(n,t,i,r,u,f,e){var o=this;this._coreConfig=n;this._basemapSelector=new w(n,t,i,r,u,f);this._selector=this._basemapSelector;e&&(this._delayLoadTimerId=window.setTimeout(function(){o.selectorReady()},w._delayLoadTimeout*1e3))}return n.prototype.dispose=function(){this._basemapSelector&&this._basemapSelector!==this._selector&&this._basemapSelector.dispose();this._selector&&(this._selector.dispose(),this._selector=null);this._basemapSelector=null;this._ready=null;window.clearTimeout(this._delayLoadTimerId)},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){n._selector.selectorReady().then(function(n){t(n)},function(){n._coreConfig&&n._coreConfig.useFallbackStyles&&(n._selector=new l(n._selector.getName()),n._basemapSelector&&n._basemapSelector.ready&&n._basemapSelector.ready.addOne(function(){n._selector=n._basemapSelector}),t(n))})})),this._ready},n.prototype.getBrandTemplates=function(n,t,i,r){return this._selector&&this._selector.getBrandTemplates(n,t,i,r)},n.prototype.getCardVectorImageTemplateAsync=function(n,t,i,r,u,f,e){this._selector&&this._selector.getCardVectorImageTemplateAsync(n,t,i,r,u,f,e)},n.prototype.getCityPolygonTemplates=function(n,t,i){return this._selector&&this._selector.getCityPolygonTemplates(n,t,i)},n.prototype.getLandmarkVectorImageTemplate=function(n,t,i){return this._selector&&this._selector.getLandmarkVectorImageTemplate(n,t,i)},n.prototype.getMarkupRecord=function(n,t,i,r){return this._selector&&this._selector.getMarkupRecord(n,t,i,r)},n.prototype.getName=function(){return this._selector&&this._selector.getName()},n.prototype.getPoiVectorImageTemplate=function(n,t,i,r,u,f){return this._selector&&this._selector.getPoiVectorImageTemplate(n,t,i,r,u,f)},n.prototype.getPushpinTextTemplates=function(n,t,i,r){return this._selector&&this._selector.getPushpinTextTemplates(n,t,i,r)},n.prototype.getSDKLandmarkImageTemplates=function(n,t,i){return this._selector&&this._selector.getSDKLandmarkImageTemplates(n,t,i)},n.prototype.getRoutePoiVectorImageTemplate=function(n,t,i){return this._selector&&this._selector.getRoutePoiVectorImageTemplate(n,t,i)},n.prototype.prefetchShields=function(n){return this._selector&&this._selector.prefetchShields(n)},n.prototype.prefetchImagesByBucketIds=function(n,t){return this._selector&&this._selector.prefetchImagesByBucketIds(n,t)},n.prototype.getFetchedShields=function(n,t,i){return this._selector&&this._selector.getFetchedShields(n,t,i)},n.prototype.getShieldsAsync=function(n,t,i,r){this._selector&&this._selector.getShieldsAsync(n,t,i,r)},n.prototype.getTemplates=function(n,t){return this._selector&&this._selector.getTemplates(n,t)},n.prototype.setProcessDrawOrder=function(n){this._selector&&this._selector.setProcessDrawOrder(n)},n}(),fi=function(){function t(n,t){this._guid=n;this._items={};this._fixedStrings=t}return t._clone=function(n,t){var i;switch(n.type){case 0:i={keyId:t,type:n.type,stringId:n.stringId};break;case 1:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform};break;case 3:i={keyId:t,type:n.type,value:n.value};break;case 2:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform}}return i},t.prototype.addItem=function(n){this._items[n.keyId]=n},t.prototype.getColorPaletteValue=function(t,i){var u=NaN,r;return t=t||0,r=this._items[t],r?(!i||r.hasValue)&&(u=r.value):n.assert(!0,"color key missing "+t),u},t.prototype.getSinglePaletteValue=function(t,i){var u=1,r;return t=t||0,r=this._items[t],r?(!i||r.hasValue)&&(u=r.value):n.assert(!0,"number key missing "+t),u},t.prototype.getBooleanPaletteValue=function(t){var r=!1,i;return t=t||0,i=this._items[t],i?r=i.value:n.assert(!0,"boolean key missing "+t),r},t.prototype.getStringPaletteValue=function(t){var r="",i;return t=t||0,i=this._items[t],i?r=this._fixedStrings[i.stringId]:n.assert(!0,"string key missing "+t),r},t.prototype._getFixedStringId=function(n){return this._fixedStrings.indexOf(n)},t.prototype.populate=function(i,r,u){var a={},o,e,y,c,l,f;if(i.nodeType){for(o=i.nodeType.properties,e={name:i.nodeType.name,parent:i.nodeType.parent,properties:i.nodeType.properties};e.parent&&e.parent.properties;)o=o.concat(e.parent.properties),e=e.parent;for(f=0;f<o.length;f++){var s=o[f].propertyName,v=i.name+"."+s,h=r[v];h?(this.addItem(h),h.hasValue=!0,a[s]=h):(y=u&&u[s],y?(c=this._getFixedStringId(v),c>=0?(l=t._clone(y,c),l.hasValue=!1,this.addItem(l),a[s]=l):n.assert(!0,"KeyId not in FixedStrings "+c)):n.assert(!0,"Palette key should be present "+v))}}if(i.children)for(f=0;f<i.children.length;f++)this.populate(i.children[f],r,a)},t}(),ht=function(){function n(n){this._maxValue=16384;this.id="SpatialGrid"+n.quadKey;this._matrixCache=new h(1024);this.bounds=[0,this._maxValue,this._maxValue,0];var t=1<<n.lod,i=1<<(n.lod>0?n.lod-1:0);this._west=n.x/t*360-180;this._east=(n.x+1)/t*360-180;this._north=90-n.y/i*180;this._south=90-(n.y+1)/i*180;this._x1=e.instance.projectToX(this._north,this._west);this._width=(e.instance.projectToX(this._south,this._east)-this._x1)/this._maxValue;this._y1=e.instance.projectToY(this._north,this._west);this._height=(e.instance.projectToY(this._south,this._east)-this._y1)/this._maxValue;this._mercatorToGridCrsMatrix=null}return n.prototype.getMatrix=function(n){var i=n.id,t=this._matrixCache.getItem(i);return t||(t=this._getMatrixInternal(n),this._matrixCache.addItem(i,t)),t},n.prototype._getMatrixInternal=function(n){var i=new bt(this._width,0,0,this._height,this._x1,this._y1),t;return n===e.instance?i:(t=n.getMatrix&&n.getMatrix(e.instance),t)?t.invert().multiply(i):null},n.prototype._getMercatorToGridCrsMatrix=function(){return this._mercatorToGridCrsMatrix||(this._mercatorToGridCrsMatrix=this._getMatrixInternal(e.instance).invert()),this._mercatorToGridCrsMatrix},n.prototype.projectToX=function(n,t){return this._project(n,t,!0)},n.prototype.projectToY=function(n,t){return this._project(n,t,!1)},n.prototype._project=function(n,t,i){var r=e.instance.projectToX(n,t),u=e.instance.projectToY(n,t),f=this._getMercatorToGridCrsMatrix();switch(i){case!0:return f.projectX(r,u);case!1:return f.projectY(r,u)}},n.prototype.toLatitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return e.instance.toLatitude(i,r)},n.prototype.toLongitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return e.instance.toLongitude(i,r)},n}(),b=function(){function t(n){var r=0,u=0,t,i;if(n===0)t=0;else{for(var e=n,o=2147483648,f=31;f&&!(e&o);)f--,o/=2;t=(f+1)/2}for(i=0;i<t;i++)r<<=1,r|=n>>(t-i-1)*2&1,i>0&&(u<<=1,u|=n>>(t-i-1)*2+1&1);for(var e=n&2147483647>>32-2*t,s="0",h=t;h--;)s+="0123".charAt(e>>h*2&3);this.quadKey=s;this.x=r;this.y=u;this.lod=t;this.crs=new ht(this);this.bounds=[0,16384,16384,0]}return t.fromLocation=function(n,i){if(i===0)return new t(1);if(i===1)return new t(n.longitude>0?3:2);var r=2<<i-2,u=Math.floor((n.longitude+180)*2*r/360),f=Math.floor((90-n.latitude)*r/180);return u=Math.min(u,r*2-1),f=Math.min(f,r-1),t.fromGridXY(u,f,i)},t.fromGridXY=function(i,r,u){var f=0,e;if(n.assertNotNull(i,"gridX"),n.assertNotNull(r,"gridY"),n.assertNotNull(u,"lod"),u===0)f=1;else{for(f=0,e=0;e<u;e++)f<<=1,f|=r>>u-e-1&1,f<<=1,f|=i>>u-e-1&1;f|=1<<u*2-1}return new t(f)},t}(),ct=function(){function n(){}return n.prototype.getRegionsInBounds=function(t,i){var r=n._getGridLod(i);return n._getRegionsInternal(t,r)},n.prototype.getRegions=function(t,i){var r=n._getGridLod(i);return n._getRegionsInternal(t,r)},n._getGridLod=function(t){var u=Math.round(t*100)/100,i,f,r;if(u<=0)throw"Scale value cannot be less than or equal to 0";for(i=0,f=n._scaleToGridLod.length;i<f;i++)if(r=n._scaleToGridLod[i],u<=r.scale)return r.lod},n._getLodFromGroundResolution=function(n,t){var i=Math.cos(t*f.radiansPerDegree)*kt.earthCircumference,r=i/n/256;return f.log2(r)},n._getRegionsInternal=function(n,t){for(var i,r,f=[],e=n.splitByInternationalDateLine(),u=0;u<e.length;u++){var o=e[u],s=b.fromLocation(o.getNorthwest(),t),h=b.fromLocation(o.getSoutheast(),t);for(i=s.x;i<=h.x;i++)for(r=s.y;r<=h.y;r++)f.push(b.fromGridXY(i,r,t))}return f},n._scaleToGridLod=[{scale:9.55,lod:14},{scale:38.22,lod:12},{scale:152.87,lod:10},{scale:611.5,lod:8},{scale:2445.98,lod:6},{scale:4891.97,lod:5},{scale:9783.94,lod:3},{scale:Number.POSITIVE_INFINITY,lod:2}],n}();t._BaseMapDataSource=y;t._BaseMapStreetsideDataSource=ii;t._EntityHelper=g;t._BaseMapTemplateSelector=w;t._BaseMapTemplateSelectorProxy=ui;t._GridId=b;t._GridCrs=ht;t._GridSpatialIndex=ct;t._LandmarkEntity=ri;t._LandmarksDataSource=st;t._LayerDataSource=p}).call(window)